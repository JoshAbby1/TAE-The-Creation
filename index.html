<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TAE Creations — Image Generator</title>
  <style>
    :root { --bg:#0b0b0c; --panel:#111214; --text:#eaeaea; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
    .wrap{max-width:860px;margin:28px auto;padding:0 16px}
    .card{background:var(--panel);border:1px solid #222;border-radius:14px;padding:18px}
    h1{margin:0 0 12px;font-size:22px}
    label{display:block;margin:14px 0 6px;font-weight:600}
    input[type="text"], textarea, select{width:100%;background:#0f1011;border:1px solid #2a2b2f;color:var(--text);border-radius:10px;padding:12px}
    textarea{min-height:92px;resize:vertical}
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    button{width:100%;padding:14px 16px;border:0;border-radius:12px;background:#ececec;color:#111;font-weight:700;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .thumb{max-width:100%;border-radius:12px;border:1px solid #222;margin-top:10px}
    .hint{opacity:.7;font-size:13px}
    .result{margin-top:16px}
    .error{color:#ff6b6b;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>TAE Creations — Image</h1>

      <label for="prompt">Prompt</label>
      <textarea id="prompt" placeholder="Describe the change..."></textarea>

      <div class="row">
        <div>
          <label for="model">Model</label>
          <select id="model">
            <option value="seedream">Seedream 4.0 (photoreal)</option>
            <option value="banana">Nano Banana (stylish/fast)</option>
          </select>
        </div>
        <div>
          <label for="strength">Edit Strength (img→img)</label>
          <input id="strength" type="range" min="0.1" max="1" step="0.05" value="0.55" />
          <div class="hint">Lower = keep face closer. Try 0.45–0.6</div>
        </div>
      </div>

      <label for="neg">Negative Prompt (optional)</label>
      <input id="neg" type="text" placeholder="cartoon, anime, painting, deformed, text, watermark" value="cartoon, anime, painting, deformed, text, watermark" />

      <div class="row">
        <div>
          <label>Upload a photo (optional)</label>
          <input id="file" type="file" accept="image/*" />
          <img id="preview" class="thumb" hidden />
        </div>
        <div>
          <label>Output Size</label>
          <select id="size">
            <option value="768x1365">9:16 — 768×1365</option>
            <option value="1024x1820">9:16 — 1024×1820</option>
            <option value="640x1138">9:16 — 640×1138 (faster)</option>
          </select>
          <div class="hint">Always 9:16 as requested</div>
        </div>
      </div>

      <div style="margin-top:14px">
        <button id="go">Generate</button>
        <div id="err" class="error" hidden></div>
      </div>

      <div class="result">
        <h3>Result</h3>
        <img id="out" class="thumb" />
      </div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('file');
    const preview = document.getElementById('preview');
    fileInput.addEventListener('change', () => {
      const f = fileInput.files[0];
      if (!f) { preview.hidden = true; return; }
      const url = URL.createObjectURL(f);
      preview.src = url;
      preview.hidden = false;
    });

    document.getElementById('go').addEventListener('click', async () => {
      const btn = document.getElementById('go');
      const out = document.getElementById('out');
      const err = document.getElementById('err');
      err.hidden = true; err.textContent = '';
      out.src = '';
      btn.disabled = true; btn.textContent = 'Generating…';

      try {
        const prompt = document.getElementById('prompt').value.trim();
        const model = document.getElementById('model').value;
        const neg = document.getElementById('neg').value.trim();
        const strength = Number(document.getElementById('strength').value);
        const [w, h] = document.getElementById('size').value.split('x').map(n => Number(n));

        // read file -> base64 (optional)
        let imageBase64 = '';
        const f = fileInput.files[0];
        if (f) {
          const buf = await f.arrayBuffer();
          const b64 = btoa(String.fromCharCode(...new Uint8Array(buf)));
          imageBase64 = `data:${f.type};base64,${b64}`;
        }

        // realism booster for likeness
        const realism =
          "ultra photorealistic, natural skin texture, detailed eyes, " +
          "soft lighting, 85mm dslr, depth of field, film grain";

        const body = {
          prompt: realism + (prompt ? ', ' + prompt : ''),
          imageBase64,
          model,
          params: {
            width: w,
            height: h,
            strength,
            guidance_scale: 4.5,
            num_inference_steps: 28,
            negative_prompt: neg
          }
        };

        const r = await fetch('/api/image-generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        const data = await r.json();
        if (!r.ok || !data.imageUrl) {
          throw new Error(data?.error || 'Generation failed');
        }
        out.src = data.imageUrl;
      } catch (e) {
        err.textContent = e.message || 'Generation failed';
        err.hidden = false;
      } finally {
        btn.disabled = false; btn.textContent = 'Generate';
      }
    });
  </script>
</body>
</html>

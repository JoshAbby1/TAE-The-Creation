<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TAE Creations — Image</title>
  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; background:#0b0b0c; color:#eaeaea; }
    .wrap { max-width: 860px; margin: 36px auto; padding: 0 16px; }
    h1 { font-size: 28px; margin: 0 0 16px; }
    label { display:block; margin: 14px 0 6px; font-weight: 600; }
    textarea { width:100%; min-height:110px; padding:12px; border-radius:10px; border:1px solid #2a2a30; background:#121214; color:#eaeaea; resize:vertical; }
    select, input[type="file"] { width:100%; padding:10px; border-radius:10px; border:1px solid #2a2a30; background:#121214; color:#eaeaea; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    button { width:100%; padding:14px; border-radius:12px; border:0; background:#5b7cff; color:white; font-weight:700; cursor:pointer; }
    button:disabled{ opacity:.6; cursor:default; }
    .hint { opacity:.75; font-size:13px; }
    .thumb { margin-top:10px; max-width:100%; border-radius:12px; border:1px solid #2a2a30; }
    .result { margin-top:22px; }
    .error { color:#ff6b6b; margin-top:10px; font-weight:600; }
    .ok { color:#79ffa8; margin-top:10px; }
    .bar { display:flex; gap:14px; align-items:center; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>TAE Creations – Image</h1>

    <label>Prompt</label>
    <textarea id="prompt" placeholder="Describe the image (e.g., 'holding a Coke can, studio light, ultra-realistic')."></textarea>

    <div class="row">
      <div>
        <label>Model</label>
        <select id="model">
          <option value="seedream4">Seedream 4.0 (photo-real)</option>
          <option value="nanobanana">Nano Banana (fast)</option>
        </select>
        <div class="hint">You can switch models. Both return **no watermark**.</div>
      </div>
      <div>
        <label>Aspect</label>
        <select id="aspect">
          <option value="1080x1920">9:16 (1080×1920)</option>
          <option value="1024x1024">1:1 (1024×1024)</option>
          <option value="1920x1080">16:9 (1920×1080)</option>
        </select>
      </div>
    </div>

    <label style="margin-top:16px;">Upload a reference photo (optional)</label>
    <input type="file" id="file" accept="image/*" />
    <img id="thumb" class="thumb" style="display:none;" alt="preview" />

    <div class="bar" style="margin:18px 0;">
      <button id="go">Generate</button>
      <div id="note" class="hint"></div>
    </div>

    <div id="msg"></div>
    <div class="result"><img id="out" style="max-width:100%; border-radius:12px; display:none;"/></div>
  </div>

  <script>
    const el = (id)=>document.getElementById(id);
    const promptEl = el('prompt');
    const modelEl  = el('model');
    const aspectEl = el('aspect');
    const fileEl   = el('file');
    const thumbEl  = el('thumb');
    const outEl    = el('out');
    const msgEl    = el('msg');
    const goBtn    = el('go');
    const noteEl   = el('note');

    // show preview
    fileEl.addEventListener('change', () => {
      const f = fileEl.files?.[0];
      if(!f){ thumbEl.style.display='none'; return; }
      const r = new FileReader();
      r.onload = () => { thumbEl.src = r.result; thumbEl.style.display='block'; };
      r.readAsDataURL(f);
    });

    async function fileToDataURL(file){
      const buf = await file.arrayBuffer();
      const b64 = btoa(String.fromCharCode(...new Uint8Array(buf)));
      return `data:${file.type};base64,${b64}`;
    }

    goBtn.onclick = async () => {
      try{
        goBtn.disabled = true; msgEl.textContent=''; outEl.style.display='none';
        noteEl.textContent = 'Working…';

        // size from aspect
        let [w,h] = aspectEl.value.split('x').map(Number);

        // read file -> data URL
        let imageBase64 = '';
        const f = fileEl.files?.[0];
        if (f) imageBase64 = await fileToDataURL(f);

        // POST to API
        const resp = await fetch('/api/image-generate', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({
            prompt: promptEl.value || '',
            model: modelEl.value,   // "seedream4" | "nanobanana"
            width: w, height: h,
            imageBase64
          })
        });

        if(!resp.ok){
          const t = await resp.text();
          msgEl.innerHTML = `<div class="error">Generation failed: ${t}</div>`;
          noteEl.textContent='';
          return;
        }

        const data = await resp.json();
        if(data.imageUrl){
          outEl.src = data.imageUrl;
          outEl.style.display='block';
          msgEl.innerHTML = `<div class="ok">Done.</div>`;
        }else{
          msgEl.innerHTML = `<div class="error">No image returned.</div>`;
        }
      }catch(err){
        msgEl.innerHTML = `<div class="error">${err}</div>`;
      }finally{
        goBtn.disabled = false; noteEl.textContent='';
      }
    };
  </script>
</body>
</html>
